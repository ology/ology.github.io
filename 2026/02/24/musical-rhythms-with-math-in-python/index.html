<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta content="width=device-width, initial-scale=1" name="viewport">
        <link href="/theme/css/normalize.css" rel="stylesheet">
        <link href="/theme/css/skeleton.css" rel="stylesheet">
        <link href="/theme/css/statocles-default.css" rel="stylesheet">
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
        <title>Musical Rhythms with Math in Python - Gene Boggs</title>
        <meta content="Statocles 0.098" name="generator">
        <link href="/2025/09/28/musical-creativity-with-python/index.html" rel="next">
        <link href="/theme/site/favicon.png" rel="shortcut icon">
        <meta content="v--gGGK7_9GCDMA9TXuSnxcvJAeU_6ZueEnLYfBRaDA" name="google-site-verification">

<script crossorigin="anonymous" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

        <link href="/theme/site/ology.css" rel="stylesheet" type="text/css">
        <script src="/theme/site/ology.js"></script>
    </head>
    <body>
        <header>
            <nav class="navbar">
                <div class="container">
                    <img src="/theme/site/banner.jpg"><br>

                    <a class="brand" href="/">Gene Boggs</a>
                    <ul>
                        <li>
                            <a href="https://www.ology.net/">www.ology.net</a>
                        </li>
                    </ul>
                    
                </div>
            </nav>
            
        </header>
        <div class="main container">
            <div class="row">
                <div class="nine columns">
                    <main>
                        <header>
    <h1>Musical Rhythms with Math in Python</h1>

    <aside>
        <time datetime="2026-02-24">
            Posted on 2026-02-24
        </time>
    </aside>

    <p class="tags">Tags:
        <a href="/tag/python/" rel="tag">Python</a>
        <a href="/tag/mathematics/" rel="tag">Mathematics</a>
        <a href="/tag/music/" rel="tag">Music</a>
        <a href="/tag/midi/" rel="tag">MIDI</a>
    </p>


</header>
<section id="section-1">
    <p>Let&#39;s talk about music programming! There are a million aspects to this subject, but today, we&#39;ll touch on generating rhythmic patterns with mathematical and combinatorial techniques. These include the generation of partitions, necklaces, and Euclidean patterns.</p>

<p>Stefan and J. Richard Hollos wrote an <a href="https://abrazol.com/books/rhythm1/">excellent little book</a> called &quot;Creating Rhythms&quot; that has been turned into <a href="https://abrazol.com/books/rhythm1/software.html">C, Perl, and Python</a>. It features a number of algorithms that produce or modify lists of numbers or bit-vectors (of ones and zeroes). These can be beat onsets (the ones) and rests (the zeroes) of a rhythm. We&#39;ll check out these concepts with Python.</p>

<p>For each example, we will play what things sound like with MIDI, by using the <a href="https://mido.readthedocs.io/en/stable/">mido</a> Python package. And in order to actually hear the rhythms, we will need a MIDI synthesizer. For the simplest illustration, we can use <a href="https://www.fluidsynth.org/">fluidsynth</a>. Of course, any MIDI capable synth will work.</p>

<p>Here&#39;s how I start <code>fluidsynth</code> on my mac in the terminal, in a <em>separate</em> session. It uses a generic soundfont file (<code>sf2</code>) that can be downloaded <a href="https://keymusician01.s3.amazonaws.com/FluidR3_GM.zip">here</a> (124MB zip).</p>

<p><code>shell
fluidsynth -a coreaudio -m coremidi -g 2.0 ~/Music/soundfont/FluidR3_GM.sf2
</code></p>

<p>So, how do Python and <code>mido</code> know what output port to use? There are a few ways, but with the <code>mido</code> package, you can do this:</p>

<p><code>python
import mido
n = mido.get_output_names()
print(n) # [&#39;FluidSynth virtual port (89324)&#39;, ...]
</code></p>

<p>This shows that <code>fluidsynth</code> is alive and ready for interaction.</p>

<p>Okay on with the show!</p>

<p>First-up, let&#39;s look at partition algorithms. With the <code>part()</code> function, we can generate all partitions of <code>n</code>, where <code>n</code> is <code>5</code>, and the &quot;parts&quot; all add up to <code>5</code>. Then taking one of these (say, the third element), we convert it to a binary sequence that can be interpreted as a rhythmic phrase, and play it 4 times.</p>

<p>```python
import time
from music_creatingrhythms import Rhythms</p>

<p>r = Rhythms()</p>

<p>parts = r.part(5)</p>

<h1>[[1, 1, 1, 1, 1], [1, 1, 1, 2], [1, 1, 3], [1, 2, 2], [1, 4], [2, 3], [5]]</h1>

<p>p = parts[2] # [1, 1, 3]</p>

<p>seq = r.int2b([p]) # [[1, 1, 1, 0, 0]]
```</p>

<p>Now we realize the rhythm:</p>

<p>```python
import mido</p>

<p>port_name = sys.argv[1] if len(sys.argv) &gt; 1 else &#39;USB MIDI&#39;
port = mido.open_output(port_name)</p>

<p>snare = 40</p>

<p>for _ in range(4):
    for bit in seq[0]:
        if bit == 1:
            msg = mido.Message(&#39;note_on&#39;, note=snare, channel=9, velocity=100)
            port.send(msg)
            time.sleep(0.5)
            msg = mido.Message(&#39;note_off&#39;, note=snare, channel=9, velocity=0)
            port.send(msg)
        else:
            time.sleep(0.5)
```</p>

<p>With this shell command, we can hear what it sounds like:</p>

<p><code>shell
python coder-legion-1.1.py &#39;FluidSynth virtual port (89324)&#39;
</code></p>

<p><audio controls>
  <source src="coder-legion-1.1.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio></p>

<p>Not terribly exciting yet! Also, the code is kind of klunky, but it illustrates things in a simple way. We <em>can</em> get all sophisticated and make a <code>class</code> when things get more complicated, of course. But for now, we&#39;ll try to keep things on the simple side.</p>

<p>Let&#39;s see what the &quot;compositions&quot; of a number reveal. According to the documentation, a composition of a number is &quot;the set of combinatorial variations of the partitions of <code>n</code> with the duplicates removed.&quot;</p>

<p>Ok. Well the 7 partitions of <code>5</code> are:
<code>
[[1, 1, 1, 1, 1], [1, 1, 1, 2], [1, 1, 3], [1, 2, 2], [1, 4], [2, 3], [5]]
</code></p>

<p>And the 16 compositions of <code>5</code> are:
<code>
[[1, 1, 1, 1, 1], [1, 1, 1, 2], [1, 1, 2, 1], [1, 1, 3], [1, 2, 1, 1], [1, 2, 2], [1, 3, 1], [1, 4], [2, 1, 1, 1], [2, 1, 2], [2, 2, 1], [2, 3], [3, 1, 1], [3, 2], [4, 1], [5]]
</code></p>

<p>That is, the list of compositions has, not only the partition <code>[1, 2, 2]</code>, but also its variations: <code>[2, 1, 2]</code> and <code>[2, 2, 1]</code>. Same with the other partitions. Selections from this list will produce possibly cool rhythms.</p>

<p>So returning to music now... Previously, we output directly to a named, open MIDI port. But going forward, we will write MIDI files to the disk. This takes a bit more code, as we shall see.</p>

<p>Here are the compositions of <code>5</code> turned into sequences, played by a snare drum, and written to the disk:</p>

<p>```python
from mido import Message, MidiFile, MidiTrack, MetaMessage, bpm2tempo
from music_creatingrhythms import Rhythms</p>

<p>def play_single(sequence):
    global mid, track
    snare = 40
    channel = 9
    t = mid.ticks_per_beat // 2 # nb: 480 = quarter-note
    for bit in sequence:
        if bit == 1:
            msg = Message(&#39;note_on&#39;, note=snare, channel=channel, velocity=100, time=0)
            track.append(msg)
            msg = Message(&#39;note_off&#39;, note=snare, channel=channel, velocity=0, time=t)
            track.append(msg)
        else: # rest
            track.append(Message(&#39;note_on&#39;, note=snare, velocity=0, time=t))
            track.append(Message(&#39;note_off&#39;, note=snare, velocity=0, time=t))</p>

<p>if <strong>name</strong> == &#39;<strong>main</strong>&#39;:
    mid = MidiFile()
    track = MidiTrack()
    mid.tracks.append(track)
    tempo = bpm2tempo(120)
    track.append(MetaMessage(&#39;set_tempo&#39;, tempo=tempo, time=0))
    track.append(MetaMessage(&#39;time_signature&#39;, numerator=4, denominator=4, time=0))</p>

<pre><code>r = Rhythms()

comps = r.compm(5, 3) # compositions of 5 with 3 elements
seq = r.int2b(comps)

for s in seq:
    play_single(s)

mid.save(&#39;coder-legion-2.1.mid&#39;)
</code></pre>

<p>```</p>

<p>In order to play the MIDI file that is produced, we can use <code>fluidsynth</code> like this:</p>

<p><code>shell
fluidsynth -i ~/Music/soundfont/FluidR3_GM.sf2 coder-legion-2.1.mid
</code></p>

<p><audio controls>
  <source src="coder-legion-2.1.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio></p>

<p>A little better. Like a syncopated snare solo.</p>

<p><strong>Sidebar</strong></p>

<p>Another way to play the MIDI file is to use <a href="https://wiki.archlinux.org/title/Timidity++">timidity</a>. On my mac, with the soundfont specified in the <code>timidity.cfg</code> configuration file, this would be:</p>

<p><code>shell
timidity -c ~/timidity.cfg -Od coder-legion-2.1.mid
</code></p>

<p>To convert a MIDI file to an mp3 (or other audio formats), I do this:</p>

<p><code>shell
timidity -c ~/timidity.cfg coder-legion-2.1.mid -Ow -o - | ffmpeg -i - -acodec libmp3lame -ab 64k coder-legion-2.1.mp3
</code></p>

<p>Ok. Enough technical details! What if we want a kick bass drum and hi-hats, too? Refactor time…</p>

<p>```python
import random
from mido import Message, MidiFile, MidiTrack, MetaMessage, bpm2tempo
from music_creatingrhythms import Rhythms</p>

<p>def open_mid():
    mid = MidiFile()
    track = MidiTrack()
    mid.tracks.append(track)
    tempo = bpm2tempo(120)
    track.append(MetaMessage(&#39;set_tempo&#39;, tempo=tempo, time=0))
    track.append(MetaMessage(&#39;time_signature&#39;, numerator=4, denominator=4, time=0))
    return mid, track</p>

<p>def play_simul(notes):
    global mid, track
    channel = 9
    duration = mid.ticks_per_beat // 4 # nb: 480 = quarter-note
    for i, n in enumerate(notes):
        bit = notes[n]
        t = duration if i == 0 else 0
        if bit == 1:
            msg = Message(&#39;note_on&#39;, note=n, channel=channel, velocity=100, time=t)
            track.append(msg)
        else: # rest
            track.append(Message(&#39;note_on&#39;, note=n, velocity=0, time=t))
    for i, n in enumerate(notes):
        bit = notes[n]
        t = duration if i == 0 else 0
        if bit == 1:
            msg = Message(&#39;note_off&#39;, note=n, channel=channel, velocity=0, time=t)
            track.append(msg)
        else: # rest
            track.append(Message(&#39;note_off&#39;, note=n, velocity=0, time=t))</p>

<p>if <strong>name</strong> == &#39;<strong>main</strong>&#39;:
    mid, track = open_mid()</p>

<pre><code>kick = 36
snare = 40
hihat = 42
repeat = 16

r = Rhythms()

s_comps = r.compm(4, 2) # snare compositions of 4 with 2 elements
# [[1, 3], [2, 2], [3, 1]]
s_seq = r.int2b(s_comps)
# [[1, 1, 0, 0], [1, 0, 1, 0], [1, 0, 0, 1]]

k_comps = r.compm(4, 3) # kick compositions of 4 with 3 elements
# [[1, 1, 2], [1, 2, 1], [2, 1, 1]]
k_seq = r.int2b(k_comps)
# [[1, 1, 1, 0], [1, 1, 0, 1], [1, 0, 1, 1]]

h_seq = [[1, 1, 1, 1]] # hihat

for _ in range(repeat):
    s_choice = random.choice(s_seq)
    k_choice = random.choice(k_seq)
    for i in range(len(s_choice)):
        simul = {
            snare: s_choice[i],
            kick: k_choice[i],
            hihat: 1,
        }
        print(simul)
        play_simul(simul)

mid.save(&#39;coder-legion-3.mid&#39;)
</code></pre>

<p>```</p>

<p><audio controls>
  <source src="coder-legion-3.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio></p>

<p>Here we play generated kick and snare patterns, along with a steady hi-hat. A bit of gymnastics happens in the <code>repeat</code> loop in order to play simultaneous notes. Corresponding changes are made to the <code>play_single()</code> function, which is renamed to <code>play_simul()</code>. This sends <code>note_on</code> messages for all the simultanous notes, followed by corresponding <code>note_off</code> messages.</p>

<p>Notice how even a little musical change involves a bunch of code, sometimes? Hrm. Also, every programmer is going to do things differently. So, YMMV. :D</p>

<p>Next up, let&#39;s look at rhythmic &quot;necklaces.&quot; Here we find many grooves of the world.</p>

<p><img alt="World rhythms" src="./rhythm-necklaces.png"></p>

<p>Image from <a href="https://cgm.cs.mcgill.ca/~godfried/publications/geometry-of-rhythm.pdf">The Geometry of Musical Rhythm</a></p>

<p>Rhythm necklaces are circular diagrams of equally spaced, connected nodes. A necklace is a lexicographical ordering with no rotational duplicates. For instance, the necklaces of <code>3</code> beats are <code>[[1, 1, 1], [1, 1, 0], [1, 0, 0], [0, 0, 0]]</code>. Notice that there is no <code>[1, 0, 1]</code> or <code>[0, 1, 1]</code>. Also, there are no rotated versions of <code>[1, 0, 0]</code>, either.</p>

<p>So, how many 16 beat rhythm necklaces are there?
<code>python
necklaces = r.neck(16)
print(len(necklaces)) # 4116 of &#39;em!
</code></p>

<p>Ok. Let&#39;s generate necklaces of <code>8</code> instead, pull a random choice, and play the pattern with a world percussion instrument.</p>

<p>Also, let&#39;s simplify the code a bit.</p>

<p>```python</p>

<h1>...</h1>

<p>if <strong>name</strong> == &#39;<strong>main</strong>&#39;:
    mid, track = open_mid()</p>

<pre><code>r = Rhythms()

necklaces = r.neck(8) # all necklaces of 8 beats
choice = random.choice(necklaces)
print(choice)

for _ in range(4):
    play_single(choice)

mid.save(&#39;coder-legion-4.1.mid&#39;)
</code></pre>

<p>```</p>

<p><audio controls>
  <source src="coder-legion-4.1.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio></p>

<p>Here we choose from <strong>all</strong> necklaces. But note that includes the sequence with all ones and the sequence with all zeroes, also. More sophisticated code might skip these.</p>

<p>More interesting would be playing simultaneous beats.</p>

<p>```python</p>

<h1>...</h1>

<p>if <strong>name</strong> == &#39;<strong>main</strong>&#39;:
    mid, track = open_mid()</p>

<pre><code>claves = 75
hi_conga = 63
low_conga = 64
repeat = 6
beats = 8

r = Rhythms()

necklaces = r.neck(beats) # all necklaces of 16 beats

x_choice = random.choice(necklaces)
y_choice = random.choice(necklaces)
z_choice = random.choice(necklaces)

for _ in range(repeat):
    for i in range(len(x_choice)):
        simul = {
            claves: x_choice[i],
            hi_conga: y_choice[i],
            low_conga: z_choice[i],
        }
        print(simul)
        play_simul(simul)

mid.save(&#39;coder-legion-4.2.mid&#39;)
</code></pre>

<p>```</p>

<p>And that sounds like:</p>

<p><audio controls>
  <source src="coder-legion-4.2.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio></p>

<p>How about Euclidean patterns? What are they, and why are they named for a geometer?</p>

<p>Euclidean patterns are a set number of positions <code>P</code> that are filled with a number of beats <code>Q</code> that is less than or equal to <code>P</code>. They are named for Euclid because they are generated by applying the &quot;Euclidean algorithm,&quot; which was originally designed to find the greatest common divisor (GCD) of two numbers, to distribute musical beats as evenly as possible.</p>

<p>```python</p>

<h1>...</h1>

<p>if <strong>name</strong> == &#39;<strong>main</strong>&#39;:
    mid, track = open_mid()</p>

<pre><code>kick = 36
snare = 40
hihat = 42
repeat = 4
beats = 16

r = Rhythms()

s_pat = r.rotate_n(4, r.euclid(2, beats)) # snare
k_pat = r.euclid(2, beats) # kick
h_pat = r.euclid(11, beats) # hihats

for _ in range(repeat):
    for i in range(beats):
        simul = {
            snare: s_pat[i],
            kick: k_pat[i],
            hihat: h_pat[i],
        }
        print(simul)
        play_simul(simul)

mid.save(&#39;coder-legion-5.mid&#39;)
</code></pre>

<p>```</p>

<p><audio controls>
  <source src="coder-legion-5.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio></p>

<p>Now we&#39;re talkin&#39; - an actual drum groove! To reiterate, the <code>euclid()</code> method distributes a number of beats, like <code>2</code> or <code>11</code> over the number of beats, <code>16</code>. The kick and snare use the same arguments, but the snare pattern is rotated by 4 beats, so that they alternate.</p>

<p><strong>So what have we learned today?</strong></p>

<ol>
<li><p>That you can use mathematical sequences to represent rhythmic patterns.</p></li>
<li><p>That you can play an entire sequence or simultaneous notes with MIDI.</p></li>
<li><p>That even small musical things, sometimes require a significant amount of code.</p></li>
</ol>

<p><strong>References:</strong></p>

<ul>
<li><p><a href="https://github.com/ology/Music/tree/master/coder-legion">Article repository</a></p></li>
<li><p><a href="https://abrazol.com/books/rhythm1/">Creating Rhythms book</a></p></li>
<li><p><a href="https://pypi.org/project/music-creatingrhythms/">Creating Rhythms Python package</a></p></li>
<li><p><a href="https://mido.readthedocs.io/en/stable/">mido</a></p></li>
<li><p><a href="https://www.fluidsynth.org/">fluidsynth</a></p></li>
<li><p><a href="https://wiki.archlinux.org/title/Timidity++">timidity</a></p></li>
</ul>

<p><strong>About the author</strong></p>

<p>Gene is a long-time musician and software engineer. His personal website is <a href="https://www.ology.net/">https://www.ology.net/</a>.</p>

</section>

<ul class="pager">
    <li class="prev">
            <a class="button button-primary" href="/2025/09/28/musical-creativity-with-python/index.html" rel="prev">
                ← Older
            </a>
    </li>
    <li class="next">
            <button disabled>
                Newer →
            </button>
    </li>
</ul>



                    </main>
                </div>

                <div class="three columns sidebar">
                    <input id="query" placeholder="Search" type="text">

                        <nav id="tags">
        <h1>Tags</h1>
        <ul class="list-inline">
            <li><a href="/tag/analysis/">analysis</a></li>
            <li><a href="/tag/audio/">audio</a></li>
            <li><a href="/tag/automata/">automata</a></li>
            <li><a href="/tag/bible/">bible</a></li>
            <li><a href="/tag/complexity/">complexity</a></li>
            <li><a href="/tag/data/">data</a></li>
            <li><a href="/tag/evolutionary/">evolutionary</a></li>
            <li><a href="/tag/fractal/">fractal</a></li>
            <li><a href="/tag/game-theory/">game theory</a></li>
            <li><a href="/tag/generative/">generative</a></li>
            <li><a href="/tag/image/">image</a></li>
            <li><a href="/tag/machine-learning/">machine learning</a></li>
            <li><a href="/tag/mathematics/">Mathematics</a></li>
            <li><a href="/tag/midi/">MIDI</a></li>
            <li><a href="/tag/music/">Music</a></li>
            <li><a href="/tag/nlp/">NLP</a></li>
            <li><a href="/tag/perl/">perl</a></li>
            <li><a href="/tag/pi/">pi</a></li>
            <li><a href="/tag/prime-numbers/">prime numbers</a></li>
            <li><a href="/tag/prolog/">prolog</a></li>
            <li><a href="/tag/psychology/">psychology</a></li>
            <li><a href="/tag/python/">Python</a></li>
            <li><a href="/tag/r/">R</a></li>
            <li><a href="/tag/software/">software</a></li>
            <li><a href="/tag/systems/">systems</a></li>
            <li><a href="/tag/web/">web</a></li>
        </ul>
    </nav>

                    
                </div>
            </div>
        </div>
        <footer>
            
            <div class="container tagline">
                <span style="float: right;">
                <a href="https://metacpan.org/pod/Statocles">Made with Statocles</a>
                </span>
                <span style="float: left;">
                Copyright (c) 2013-2023 by <a href="https://gene.ology.net/">Gene Boggs</a>, Epistemologist-at-large
                </span>
            </div>
        </footer>


    </body>
</html>
